# Variable Stiffness Controller Configuration for OpenManipulator-X
# Single robot hardware configuration

/omx/controller_manager:
  ros__parameters:
    update_rate: 500
    use_sim_time: false

    joint_state_broadcaster:
      type: joint_state_broadcaster/JointStateBroadcaster

    variable_stiffness_controller:
      type: omx_variable_stiffness_controller/OmxVariableStiffnessController

/omx/variable_stiffness_controller:
  ros__parameters:
    # Joint configuration
    joints:
      - joint1
      - joint2
      - joint3
      - joint4
    root_link: world
    tip_link: link5

    # Robot description source - adjust based on your setup
    robot_description_node: /omx/robot_state_publisher

    # Torque scaling (KDL outputs Nm; Dynamixel uses raw units)
    # XM430-W350 torque constant ≈ 1.4 Nm/A → scale = 1/(1.4*0.00269) ≈ 267
    # Start conservative, tune up/down based on behavior
    torque_scale: 200.0

    # Trajectory timing parameters
    homing_duration: 5.0          # Time to move from current pose to start_position
    move_duration: 10.0           # Time for forward/return motion
    wait_duration: 2.0            # Pause duration at endpoints

    # Stiffness rate limiting (safety)
    max_rise_rate: 100.0          # Max stiffness change per second (N/m/s)

    # Cartesian waypoints [x, y, z] in meters
    start_position: [0.20, 0.0, 0.15]
    end_position: [0.25, 0.0, 0.15]

    # Target orientation [roll, pitch, yaw] in radians
    target_orientation: [0.0, 0.0, 0.0]

    # Stiffness parameters (N/m for translation, Nm/rad for rotation)
    # HARDWARE LIMITS: Max translational stiffness = 65 N/m, Max damping = 3 Ns/m
    stiffness_homing: [50.0, 50.0, 50.0]    # Stiffness during homing/waiting
    stiffness_rot: [15.0, 15.0, 15.0]       # Rotational stiffness (max 20 Nm/rad)

    # Damping parameters (Ns/m for translation, Nms/rad for rotation)
    # HARDWARE LIMITS: Max translational damping = 3 Ns/m, Max rotational damping = 1 Nms/rad
    damping_rot: [0.8, 0.8, 0.8]            # Rotational damping
    damping_default: [2.5, 2.5, 2.5]        # Default linear damping

    # Stiffness/damping profiles (optional - loaded from CSV by load_stiffness.py)
    # Can be filled dynamically at runtime via parameter updates or topics
    # Each profile should have the same length - values are interpolated along trajectory
    stiffness_profile_x: []
    stiffness_profile_y: []
    stiffness_profile_z: []
    damping_profile_x: []
    damping_profile_y: []
    damping_profile_z: []
